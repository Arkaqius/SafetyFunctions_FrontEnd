---
interface Props {
  title: string;
}

import Toolbar from '../components/Toolbar.astro';

const { title } = Astro.props;

// Get all faults from global state
const faults = [
  {
    type: 'Gas Leak Detected',
    location: 'Kitchen',
    severity: 'danger',
    priority: 1,
    timestamp: new Date().toISOString()
  },
  {
    type: 'Window Open During Storm',
    location: 'Living Room',
    severity: 'warning',
    priority: 2,
    timestamp: new Date(Date.now() - 1800000).toISOString()
  },
  {
    type: 'Risky Temperature',
    location: 'Bedroom',
    severity: 'warning',
    priority: 3,
    timestamp: new Date(Date.now() - 3600000).toISOString()
  }
];

// Get the highest priority (lowest number) from faults
const highestPriority = Math.min(...faults.map(fault => fault.priority));

const backgroundStyles = {
  0: 'bg-gradient-to-br from-red-500 via-red-600 to-red-700',
  1: 'bg-gradient-to-br from-orange-400 via-orange-500 to-orange-600',
  2: 'bg-gradient-to-br from-amber-400 via-amber-500 to-amber-600',
  3: 'bg-gradient-to-br from-yellow-300 via-yellow-400 to-yellow-500',
  4: 'bg-gradient-to-br from-blue-400 via-blue-500 to-blue-600'
};

const pulseAnimation = highestPriority === 0 ? 'animate-pulse' : '';
---

<!doctype html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="House Safety Monitoring System" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
  </head>
  <body class={`min-h-screen text-gray-100 ${backgroundStyles[highestPriority]} ${pulseAnimation}`}>
    <Toolbar />
    <slot />
  </body>
</html>

<style>
  @keyframes subtle-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.95; }
  }
  .animate-pulse {
    animation: subtle-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
</style>