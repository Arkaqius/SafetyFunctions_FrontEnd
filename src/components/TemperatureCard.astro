---
import PriorityBadge from './PriorityBadge.astro';
import { TemperatureChart } from './TemperatureChart';

interface Props {
  room: {
    name: string;
    currentTemp: number;
    threshold: { min: number; max: number };
    forecast: number;
    rateOfChange: number;
    history: { time: string; value: number }[];
    recoveryAction: {
      title: string;
      description: string;
      status: string;
    } | null;
    status: 'normal' | 'warning' | 'danger';
    priority: number;
  };
}

const { room } = Astro.props;

const chartData = {
  labels: room.history.map(h => h.time),
  datasets: [
    {
      label: 'Temperature',
      data: room.history.map(h => h.value),
      borderColor: 'rgb(6, 182, 212)',
      tension: 0.1
    },
    {
      label: 'Threshold Max',
      data: room.history.map(() => room.threshold.max),
      borderColor: 'rgba(239, 68, 68, 0.5)',
      borderDash: [5, 5]
    },
    {
      label: 'Threshold Min',
      data: room.history.map(() => room.threshold.min),
      borderColor: 'rgba(59, 130, 246, 0.5)',
      borderDash: [5, 5]
    }
  ]
};
---

<div class="bg-gray-800 p-6 rounded-lg shadow-lg">
  <div class="flex justify-between items-start mb-4">
    <div>
      <h3 class="text-xl font-semibold">{room.name}</h3>
      <div class="mt-2">
        <p class="text-2xl font-bold">{room.currentTemp.toFixed(1)}°C</p>
        <p class="text-sm text-gray-400">
          Rate: {room.rateOfChange > 0 ? '+' : ''}{room.rateOfChange}°C/hr
        </p>
        <p class="text-sm text-gray-400">
          Forecast: {room.forecast}°C
        </p>
      </div>
    </div>
    <PriorityBadge priority={room.priority} />
  </div>

  <div class="h-48 mb-4">
    <TemperatureChart client:load chartData={chartData} />
  </div>

  {room.recoveryAction && (
    <div class="mt-4 border-t border-gray-700 pt-4">
      <h4 class="text-sm font-medium text-gray-300 mb-2">Recovery Action</h4>
      <div class="bg-gray-900 p-3 rounded">
        <p class="font-medium text-sm">{room.recoveryAction.title}</p>
        <p class="text-sm text-gray-400 mt-1">{room.recoveryAction.description}</p>
        <span class="inline-block mt-2 px-2 py-1 text-xs font-medium bg-yellow-900/50 text-yellow-200 rounded">
          {room.recoveryAction.status}
        </span>
      </div>
    </div>
  )}
</div>